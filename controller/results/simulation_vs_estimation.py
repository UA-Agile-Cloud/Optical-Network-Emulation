#!/usr/bin/env python

# Simulation OSNR calculations vs RWA Estimation

import matplotlib.pyplot as plt
import numpy as np
import matplotlib.patches as mpatches
from decimal import *
import numpy as np
getcontext().prec = 16

# Simulation results
sim_results = [
[105.38945215878431, 72.89881387910182, 49.60070355255819, 34.048478884655054, 29.802153643606957, 29.80215364360696],
[239.65552953345326, 75.02299989282692, 50.64569694402955, 41.733316225254455, 29.944632722216713, 29.94463272221671],
[114.38482226637606, 78.06496566866625, 52.95531263494744, 36.19743740574102, 27.825891265998983, 27.825891265998983],
[116.20935335807175, 56.58235858852733, 41.82631944025534, 35.65622157444867, 26.94416269290212, 26.94416269290212],
[150.57098911512853, 75.28549545586677, 48.22311760939444, 36.65997083078681, 32.458236112851864, 32.458236112851864],
[244.19115124802977, 77.08032018369414, 42.417124327936726, 30.63389693106076, 23.974047647722976, 23.974047647722973],
[160.38394321596877, 65.34567399511035, 41.55971611814842, 33.24467936841818, 33.244679368418176],
[173.87132855169105, 71.55997889925982, 44.503714322378094, 35.1898127321333, 35.18981273213329],
[155.19852541393294, 62.76685472710133, 39.3381883627503, 28.925419909438, 28.925419909438],
[109.2767598034988, 53.648955007994516, 35.55137472618373, 28.925419909437984, 28.925419909437988],
[201.08338446868962, 86.09966712105232, 52.442185780937834, 39.04818599993158, 34.31650447475729, 34.316504474757295],
[258.086885480135, 84.87229353968901, 47.493910387890324, 34.34837289184768, 28.703134019383402, 28.703134019383405],
[164.63606842363816, 98.60544167598447, 61.66965230991752, 40.454691200467884, 34.78727729937147, 34.78727729937147],
[258.086885480135, 85.25493325676585, 57.28864175790698, 46.801768157722435, 36.91037338887291, 36.91037338887291],
[266.693830456028, 109.60169476818177, 60.57189106717111, 42.39515947723235, 42.39515947723234],
[111.31024090800018, 54.13448096573607, 40.135054756416, 34.31131617662141, 34.31131617662141],
[111.93143521901375, 54.44447736224156, 40.35007041368293, 34.48304247406314, 34.48304247406313],
[280.90959557429005, 117.19310362557479, 66.49683351912816, 53.85196968676755, 53.85196968676756],
[238.9637870439037, 74.66242615799327, 50.410904753001105, 41.5523862694564, 41.5523862694564],
[155.8659721513554, 84.97360839804564, 63.27118294409397, 27.56835553330163, 27.56835553330163],
[63.864450172825904, 51.494021521459125, 41.19397179943243, 33.33184774339678, 33.331847743396786],
[98.3304333196343, 78.65592862483962, 46.60696998364701, 33.60479493358736, 33.604794933587364],
[116.35242782019847, 56.616256097265605, 49.431643618116865, 32.43398168881567, 32.43398168881567],
[118.28405148234113, 58.15088246424537, 42.97259193739837, 35.23815735450014, 35.238157354500146],
[232.44480553410045, 107.8148781913029, 62.82771260468176, 44.655170689726674, 44.65517068972667],
[167.10618265307613, 67.90416345120912, 48.416287656837405, 31.164042885478075, 31.16404288547808],
[96.66636723310592, 62.72706042764522, 41.66629758287686, 33.72996185191884, 33.72996185191884],
[121.61141852590852, 59.81342322389091, 44.11906959828132, 36.12569241920535, 31.71504923910605, 31.715049239106047],
[259.7643971454998, 112.80523565424812, 67.51229247054273, 42.903980783199756, 31.71504923910606, 31.71504923910606],
[156.48487240563287, 76.73549102606522, 64.97121543098227, 43.77210029707737, 34.103059278481716, 34.10305927848171],
[114.17440599580026, 51.65173363769074, 45.60458601746434, 32.26242199938583, 25.258654478827243, 25.25865447882724],
[173.87132855169105, 71.55997889925982, 44.503714322378094, 32.29371496612058, 32.29371496612058],
[135.40298497403592, 67.70149321345248, 45.55658252718902, 36.80676192237805, 36.806761922378044],
[173.87132855169105, 71.55997889925982, 44.503714322378094, 35.1898127321333, 35.18981273213329],
[155.19852541393294, 62.76685472710133, 39.867556663973104, 31.95489279081447, 31.954892790814476],
[206.50217535392574, 88.34043935513084, 55.6754757824194, 43.60283095450425, 36.7155891999521, 36.7155891999521],
[217.4545752262551, 100.27083116055555, 57.60915740073875, 40.75253110671961, 33.606047202377155, 33.606047202377155],
[166.16155071712777, 67.67378961442125, 41.93757751351642, 33.2446793684182, 28.326333878422336, 25.46603924514249, 25.46603924514249],
[247.73178107157636, 106.50517547165764, 63.27118294409396, 39.62235368002055, 29.122520418271105, 24.677233493510673, 24.67723349351067],
[135.40298497403592, 101.88160953397613, 54.891409976347376, 39.37350696408641, 32.66267649749249, 32.66267649749248],
[161.003106784613, 65.09511134266343, 37.7038011329394, 34.33795875058103, 25.899418390974674, 25.899418390974674],
[79.07162482786062, 52.95653248252877, 39.74465098445094, 29.034085618785767, 25.98072458278702, 25.980724582787015],
[247.04793948244665, 75.02182069670684, 51.00307205922716, 38.69473082740001, 25.98072458278702, 25.980724582787023],
[109.89724838506156, 53.95866675675382, 35.75770689974347, 26.73847248290641, 26.738472482906403],
[110.27554237035407, 55.13777166701214, 36.75851455174924, 27.806270278904602, 27.8062702789046],
[118.28405148234113, 58.15088246424537, 38.551895135747415, 31.23724636866833, 31.23724636866833],
[160.38394321596877, 65.34567399511035, 41.031658004423065, 30.184163436309962, 30.18416343630997],
[127.99414816603395, 63.00805427431557, 41.790092853271375, 33.72106141101663, 28.976500615429366, 28.97650061542937],
[199.3940548599593, 91.22027417919502, 51.39216644264835, 35.77310490239695, 27.64196857829797, 27.64196857829797],
[163.1996848852446, 81.34096144919411, 46.84623694496007, 33.20562166553272, 25.71729827628666, 25.71729827628666]]



est_results =[
[182.16078616178515, 110.9863671625148, 71.69444724348794, 48.640754744399096, 40.222151814724214, 40.222151814724214],
[310.3408764981114, 112.4951166094159, 72.37928049403666, 56.26672858024552, 40.247039348939865, 40.247039348939865],
[182.16078616178515, 110.9863671625148, 71.69444724348794, 48.38760993731278, 35.95807290830542, 35.95807290830542],
[187.5020217069319, 88.65947581856834, 61.05409663945137, 48.83133179748059, 35.946742187098074, 35.94674218709808],
[181.9628110108528, 87.25644675907897, 53.81716604257432, 38.97190337722615, 33.046976879996684, 33.04697687999669],
[310.42378565042645, 112.22472897149932, 63.4293778120162, 44.15411699825075, 33.12105011717664, 33.12105011717664],
[231.04995369411122, 98.16660849511541, 60.828102399642745, 45.87539840770911, 45.87539840770911],
[236.36553816400152, 100.3958817572308, 61.32132571570068, 45.94501370574067, 45.945013705740664],
[230.98768218888478, 98.13903237838866, 60.358614399653064, 42.73439522704392, 42.734395227043926],
[185.58195491669392, 88.16527771413163, 56.095863680716505, 42.721288850662695, 42.721288850662695],
[231.23676820978295, 98.24933684529418, 58.27552077462249, 41.50668506340587, 34.9715355490107, 34.9715355490107],
[309.84342158417513, 112.00623065921693, 63.29996855758972, 44.05989992511846, 34.90513097463031, 34.90513097463031],
[231.17449670456017, 128.43343046927802, 79.13062244663895, 52.28109404968952, 42.82845440720121, 42.828454407201214],
[309.9263307365033, 112.33865295866194, 72.27514639565275, 56.18361268111506, 42.775971761749474, 42.775971761749474],
[307.9853930833133, 128.36251014157443, 71.67378831198526, 48.831331797480566, 48.83133179748057],
[187.6547255732617, 88.73475732876875, 61.10775513780452, 48.87541632878406, 48.87541632878406],
[187.6038242844859, 88.70966349203546, 61.08986897168688, 48.86072148501629, 48.860721485016285],
[307.8206749122126, 128.2915898138692, 72.14161258150794, 56.18361268111509, 56.1836126811151],
[310.42378565042645, 112.52640933956577, 72.40010731371308, 56.2833517600714, 56.283351760071405],
[231.17449670456017, 119.10104659485974, 83.58737089169003, 45.78616207306921, 45.78616207306921],
[120.69252057734641, 84.39447702290792, 61.037661881968575, 45.75837706160793, 45.75837706160793],
[166.2060734412884, 118.0852483666824, 68.07173115112477, 46.994451370455806, 46.994451370455806],
[187.57786421166972, 88.66517555606588, 71.83868114030287, 46.98023612992404, 46.98023612992403],
[185.58195491669392, 88.16527771413163, 60.79244808006207, 46.99021766775834, 46.990217667758344],
[261.8590761563779, 119.03499703097995, 68.41443088416531, 47.01866079081666, 47.01866079081666],
[233.46754748873192, 98.70002580472881, 66.36363433963088, 43.26560182592869, 43.26560182592869],
[154.45076516625792, 89.56260258903689, 56.72138845487633, 43.21269048346186, 43.21269048346186],
[185.78366010931748, 88.26518910033795, 60.86375671922296, 47.04710391387466, 39.20888740152602, 39.20888740152602],
[316.7869669578756, 139.66577057225882, 83.53985664851957, 54.02957277244247, 39.18453520560099, 39.18453520560099],
[187.83253616062677, 88.7906849507196, 71.9422180957461, 47.05131233258211, 35.06601440194785, 35.06601440194785],
[185.68280751300733, 83.9887043930197, 68.63226468255739, 46.84177863031825, 35.021657662822626, 35.021657662822626],
[236.23838538742626, 100.33963883663073, 61.28546065948045, 43.004777636051344, 43.004777636051344],
[181.9628110108528, 87.25644675907897, 56.079263423826035, 42.92579819816614, 42.92579819816614],
[236.30196177571457, 100.3677602969309, 61.30339318759064, 45.9310906461345, 45.9310906461345],
[230.86313917842836, 98.08388014493444, 60.77462092027159, 45.833629228889365, 45.833629228889365],
[236.36553816400152, 100.3958817572308, 61.32132571570068, 45.94501370574067, 37.1198465083168, 37.1198465083168],
[262.0700231420085, 119.13407137679914, 68.47385465725176, 47.061325475403585, 37.09660282303421, 37.0966028230342],
[236.23838538742626, 100.33963883663073, 61.28546065948045, 45.917167586528215, 37.09660282303419, 31.71938974605158, 31.71938974605158],
[316.9562812506291, 139.74259338556223, 83.58737089169004, 54.061676946076304, 39.20888740152602, 31.709170776618077, 31.709170776618077],
[181.9628110108528, 126.08655810814906, 68.01257581124197, 46.79925249572347, 36.908769830035126, 36.908769830035126],
[236.17480899913664, 100.31151737633031, 59.06038923879274, 50.54969081430117, 36.966724742307846, 36.96672474230784],
[154.53530860299185, 89.75494571761016, 61.914003806811834, 43.493759389347446, 36.57952145341838, 36.57952145341838],
[316.8716241042535, 113.06794824425931, 73.01505231457115, 52.9986435884743, 36.5680315156621, 36.56803151566209],
[185.83408640747137, 88.290166946889, 56.17886496516745, 40.197786063447886, 40.197786063447886],
[181.9628110108528, 87.25644675907897, 55.68765804335989, 40.1232005596024, 40.1232005596024],
[185.58195491669392, 88.16527771413163, 56.095863680716505, 42.721288850662695, 42.721288850662695],
[231.17449670456017, 98.22176072856817, 60.41174200529903, 42.773714356187334, 42.773714356187334],
[185.68280751300733, 88.2152334072352, 56.12906419449718, 42.74750160342515, 34.86102129088811, 34.86102129088811],
[262.0700231420085, 119.13407137679914, 68.47385465725176, 46.773202605843544, 34.89416302039934, 34.89416302039933],
[235.8040261179972, 113.95548782308889, 66.92389752974258, 46.40509348364744, 34.7599259964458, 34.7599259964458]]

difference = []
difference_dB = []

sim_r_dB = [Decimal(10*np.log10(value[-2])) for value in sim_results]
est_r_dB = [Decimal(10*np.log10(value[-2])) for value in est_results]

fixed_est_r_dB = [np.double(est_r_dB[i]) - 1.111613661127074 for i in range(0,50)]# difference mean

for i in range(0,len(sim_r_dB)):
	difference_dB.append(abs(np.double(est_r_dB[i]) - np.double(sim_r_dB[i])))

diff_len = []
for i in range(0,50):
	diff_len.append(i+1)

plt.plot(diff_len, sim_r_dB, 'b', marker='o')
plt.plot(diff_len, est_r_dB, 'r', marker='*')

plt.xlabel('Path')
plt.ylabel('OSNR (dB)')
plt.grid(True)

blue_patch = mpatches.Patch(color='blue', label='Simulator Calculation')
red_patch = mpatches.Patch(color='red', label='Controller Estimation')
# PLOT VARIATION
# diff_len = []
# for i in range(0,50):
# 	diff_len.append(i+1)
# print diff_len
# plt.plot(diff_len, difference_dB, 'b', marker='o')
# mu = [np.mean(difference_dB)] * 50
# plt.plot(diff_len, mu, 'r')


for i in range(0,len(sim_results)):
	difference.append(est_results[i][-2] - sim_results[i][-2])

# print np.std(difference_dB)
# print np.var(difference_dB)
# print np.mean(difference_dB)
# print np.median(difference_dB)
plt.legend(handles=[blue_patch, red_patch])
plt.show()